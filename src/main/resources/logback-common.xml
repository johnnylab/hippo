<?xml version="1.0" encoding="UTF-8"?>
<included>  
	<!-- 应用程序输出日志的路径 -->
	<property name="APPLICATION_LOG_FILE_HOME" value="/opt/logs" />
	​
	<!-- sql日志路径 -->
	<property name="SQL_LOG_FILE_HOME" value="/opt/sql-logs" />
	<!-- 控制台输出日志的格式 -->
	<property name="CONSOLE_LOG_PATTERN"
		value="[%-5level] %d{HH:mm:ss} %logger{50}:%method  [%thread]-%-50msg%n " />
	<!-- 控制台输出 -->
	<appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
		<encoder>
			<pattern>${CONSOLE_LOG_PATTERN}</pattern>
			<charset>utf8</charset>
		</encoder>
	</appender>
	<appender name="APPLICATION_LOG"
		class="net.logstash.logback.appender.LoggingEventAsyncDisruptorAppender">
		<appender class="ch.qos.logback.core.rolling.RollingFileAppender">
			<waitStrategyType>sleeping</waitStrategyType>
			<rollingPolicy
				class="ch.qos.logback.core.rolling.SizeAndTimeBasedRollingPolicy">
				<FileNamePattern>${APPLICATION_LOG_FILE_HOME}/hippo-test-%d{yyyy-MM-dd}-%i.log
				</FileNamePattern>
				<MaxHistory>30</MaxHistory>
				<maxFileSize>500MB</maxFileSize>
			</rollingPolicy>
			<encoder
				class="net.logstash.logback.encoder.LoggingEventCompositeJsonEncoder">
				<providers>
					<logLevel>
						<fieldName>level</fieldName>
					</logLevel>
					<message>
						<fieldName>msg</fieldName>
					</message>
					<logstashMarkers />
					<mdc />
					<timestamp>
						<fieldName>time</fieldName>
						<pattern>yyyy-MM-dd HH:mm:ss</pattern>
						<timeZone>GMT+8</timeZone>
					</timestamp>
					<pattern>
						<pattern>
							{
							"method":"%logger{50}:%method",
							"trace_id":
							"%X{X-B3-TraceId:-}",
							"span_id":"%X{X-B3-SpanId:-}",
							"parent_span_id": "%X{X-B3-ParentSpanId:-}",
							"exportable_span_id": "%X{X-Span-Export:-}",
							"from":"%X{X-B4-fromServiceName:-}",
							"to":"%X{X-B4-toServiceName:-}",
							"thread": "%thread"
							}
						</pattern>
					</pattern>
					<stackTrace>
						<throwableConverter
							class="net.logstash.logback.stacktrace.ShortenedThrowableConverter">
							<maxDepthPerThrowable>30</maxDepthPerThrowable>
							<maxLength>2048</maxLength>
							<shortenedClassNameLength>30</shortenedClassNameLength>
							<exclude>^sun\.reflect\..*\.invoke</exclude>
							<exclude>^net\.sf\.cglib\.proxy\.MethodProxy\.invoke</exclude>
							<rootCauseFirst>true</rootCauseFirst>
						</throwableConverter>
					</stackTrace>
				</providers>
			</encoder>
		</appender>
	</appender>
	<root level="info">
		<appender-ref ref="APPLICATION_LOG" />
		<appender-ref ref="CONSOLE" />
	</root>
</included>